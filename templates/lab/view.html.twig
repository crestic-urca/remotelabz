{% extends 'lab/index.html.twig' %}

{% block breadcrumbs %}
    {%- set breadcrumbs = breadcrumbs|merge({ (lab.name): path('show_lab', {'id': lab.id}) }) -%}
    {{ parent() }}
{% endblock %}

{% block wrapper %}
<div class="row">
    <div class="col grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">
                    {{ lab.name }}
                    <div class="float-right">
                        {% if lab.instances[0] is not defined or (lab.instances[0] is defined and not lab.instances[0].isStarted) %}
                            <a href="{{ path('start_lab', {'id': lab.id}) }}" class="btn btn-outline-primary" role="button">
                                {{ 'Start all'|trans }}
                            </a>
                            <a href="{{ path('edit_lab', {'id': lab.id}) }}" class="btn btn-outline-secondary" role="button">
                                <i class="fa fa-edit"></i> {{ 'Edit'|trans }}
                            </a>
                        {% endif %}
                        {% if lab.instances[0] is defined %}
                            <a href="{{ path('stop_lab', {'id': lab.id}) }}" class="btn btn-outline-danger" role="button">{{ 'Stop all'|trans }}
                            </a>
                        {% endif %}
                    </div>
                </h4>
                <p>Created by {{ lab.author.firstName }} {{ lab.author.lastName }}</p>
<br>
                <h3>Devices :</h3>
                <hr>
                {% set isVNC = false %}

                {% for device in lab.devices %}
                <div class="wrapper align-items-center py-4 {% if not loop.last %}border-bottom{% endif %}">
                    <a href="{{ path('show_device', {'id': device.id}) }}">
                        {{ device.name }}
                    </a>
                    {% for networkInterface in device.networkInterfaces %}
                        {% if networkInterface.settings is defined %}
                            {% if networkInterface.settings.protocol == "VNC" %}
                                {% set isVNC = true %}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    <div class="float-right">
                        {%- set startDeviceButton -%}
                            <a href="{{ path('start_lab_device', {'id': lab.id, 'deviceId': device.id}) }}" class="btn btn-success" role="button" title="Start device" data-toggle="tooltip" data-placement="top">
                                <i class="fa fa-play"></i>
                            </a>
                        {%- endset -%}
                        {%- if device.instances[0] is defined -%}
                            {%- if not device.instances[0].isStarted -%}
                                {{ startDeviceButton }}
                            {%- endif -%}
                        {%- elseif device.instances[0] is not defined -%}
                            {{ startDeviceButton }}
                        {%- endif -%}

                        {%- set stopDeviceButton -%}
                            <a href="{{ path('stop_lab_device', {'id': lab.id, 'deviceId': device.id}) }}" class="btn btn-danger" role="button" title="Stop device" data-toggle="tooltip" data-placement="top">
                                <i class="fa fa-stop"></i>
                            </a>
                        {%- endset -%}
                        {%- if device.instances[0] is defined and device.instances[0].isStarted -%}
                            {{ stopDeviceButton }}
                        {%- endif -%}

                        {% if isVNC %}
                            {%- set viewDeviceButton -%}
                                <a href="{{ path('view_lab_device', {'id': lab.id, 'deviceId': device.id}) }}" class="btn btn-primary" role="button" title="View console" data-toggle="tooltip" data-placement="top">
                                    <i class="fa fa-eye"></i>
                                </a>
                            {%- endset -%}
                            {%- if device.instances[0] is defined and device.instances[0].isStarted -%}
                                {{ viewDeviceButton }}
                            {%- endif -%}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}

                {% if output is defined %}
                {{ dump(output|cast_to_array)}}
                {% endif %}
                
                {# {{ dump(lab|cast_to_array)}} #}
                {# {% for key, value in lab|cast_to_array %}
                    <p>{{ key }} : {{ value }}</p>
                    <hr>
                {% endfor %} #}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {# {{ encore_entry_script_tags('lab') }} #}
{% endblock %}